/**
 * @file AuditLog.ts
 * @description Módulo de gestión de registros de auditoría ISO 27001.
 *              Solo permite visualización de cambios en entidades del sistema.
 * @author Equipo de Desarrollo
 * @date 2025
 * @module Auditoria
 */
// Seleccionar/deseleccionar todos los checkboxes
$(document).on('change', '#selectAllAuditLog', function () {
    var isChecked = $(this).is(':checked');
    $('.selectAuditLog').prop('checked', isChecked);
});
// Ver detalles del registro seleccionado
$(document).on('click', '.ViewAuditLogDetails', function () {
    showAuditLogDetails();
});
// Función para mostrar detalles de auditoría
function showAuditLogDetails() {
    var recId = 0;
    var contador = 0;
    $(".selectAuditLog[type=checkbox]").each(function () {
        if ($(this).is(":checked")) {
            contador++;
            recId = parseInt($(this).closest('.row-app').attr('data-recid') || '0');
        }
    });
    if (contador === 0) {
        windows_message("Debe seleccionar un registro para ver los detalles", "error");
        return;
    }
    if (contador > 1) {
        windows_message("Debe seleccionar solo un registro", "info");
        return;
    }
    // Obtener los datos del registro
    $.ajax({
        url: "/auditoria/getbyid",
        type: "GET",
        data: { RecId: recId },
        async: true,
        success: function (data) {
            if (data != null) {
                populateAuditLogModal(data);
                $('.modal-AuditLogDetails').modal('show');
            }
            else {
                windows_message("Error obteniendo datos del registro", "error");
            }
        },
        error: function (xhr) {
            redireccionaralLogin(xhr);
        }
    });
}
// Llenar el modal con los datos
function populateAuditLogModal(data) {
    var _a, _b;
    // Soportar tanto camelCase como PascalCase
    $('#audit-detail-recid').val(((_a = (data.recId || data.RecId)) === null || _a === void 0 ? void 0 : _a.toString()) || '');
    $('#audit-detail-dataareaid').val(data.dataAreaId || data.DataAreaId || '');
    $('#audit-detail-entityname').val(data.entityName || data.EntityName || '');
    $('#audit-detail-fieldname').val(data.fieldName || data.FieldName || '');
    $('#audit-detail-changedby').val(data.changedBy || data.ChangedBy || '');
    $('#audit-detail-changedat').val(formatDateTime(data.changedAt || data.ChangedAt));
    $('#audit-detail-entityrefrecid').val(((_b = (data.entityRefRecId || data.EntityRefRecId)) === null || _b === void 0 ? void 0 : _b.toString()) || '');
    $('#audit-detail-oldvalue').val(data.oldValue || data.OldValue || '');
    $('#audit-detail-newvalue').val(data.newValue || data.NewValue || '');
}
// Formatear fecha y hora
function formatDateTime(dateString) {
    if (!dateString)
        return '';
    var date = new Date(dateString);
    var day = date.getDate() < 10 ? '0' + date.getDate() : String(date.getDate());
    var month = (date.getMonth() + 1) < 10 ? '0' + (date.getMonth() + 1) : String(date.getMonth() + 1);
    var year = date.getFullYear();
    var hours = date.getHours() < 10 ? '0' + date.getHours() : String(date.getHours());
    var minutes = date.getMinutes() < 10 ? '0' + date.getMinutes() : String(date.getMinutes());
    var seconds = date.getSeconds() < 10 ? '0' + date.getSeconds() : String(date.getSeconds());
    return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
}
// Cerrar modal de detalles
$(document).on('click', '.close-modal-auditlog-details', function () {
    $('.modal-AuditLogDetails').modal('hide');
});
// Doble clic en fila para ver detalles
$(document).on('dblclick', '.tbody-Table-AuditLog .row-app', function () {
    // Desmarcar todos los checkboxes
    $('.selectAuditLog').prop('checked', false);
    // Marcar el checkbox de la fila actual
    $(this).find('.selectAuditLog').prop('checked', true);
    // Mostrar detalles
    showAuditLogDetails();
});
// Filtro de datos
$(document).on('change', '#auditlog-page .optionFilter', function () {
    optionFilterFunction(this);
    if ($('.textFilter').val() != "") {
        Datafilter(".tbody-Table-AuditLog", "/auditoria/FilterOrMoreData");
    }
});
$(document).on('keyup', '#auditlog-page .textFilterMask', function (e) {
    var keycode = e.keyCode || e.which;
    if (keycode == 13) {
        textFilterMaskFunction(this);
        Datafilter(".tbody-Table-AuditLog", "/auditoria/FilterOrMoreData");
    }
});
// Scroll infinito para paginación
$(document).on('scroll', '#auditlog-page #content-scroll', function () {
    let currentscroll = $("#content-scroll").scrollTop();
    let maxscroll = $(".tblAuditLog").outerHeight(true) - $("#content-scroll").outerHeight(true);
    if (currentscroll == Math.round(maxscroll)) {
        if (!isBusy) {
            moredata(maxscroll, "auditoria", ".tbody-Table-AuditLog");
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXVkaXRMb2cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9UeXBlU2NyaXB0RmlsZS9BdWRpdExvZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztHQU9HO0FBbUJILGlEQUFpRDtBQUNqRCxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRSxvQkFBb0IsRUFBRTtJQUMzQyxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDLENBQUM7QUFFSCx5Q0FBeUM7QUFDekMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUU7SUFDNUMsbUJBQW1CLEVBQUUsQ0FBQztBQUMxQixDQUFDLENBQUMsQ0FBQztBQUVILDZDQUE2QztBQUM3QyxTQUFTLG1CQUFtQjtJQUN4QixJQUFJLEtBQUssR0FBVyxDQUFDLENBQUM7SUFDdEIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBRWpCLENBQUMsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNyQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUN6QixRQUFRLEVBQUUsQ0FBQztZQUNYLEtBQUssR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDNUUsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxRQUFRLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDakIs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RyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUM5RSxJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNuRyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDOUIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQ25GLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztJQUMzRixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7SUFDM0YsT0FBTyxHQUFHLEdBQUcsSUFBSSxLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssSUFBSSxPQUFPLElBQUksT0FBTyxFQUFFLENBQUM7QUFDcEUsQ0FBQztBQUVELDJCQUEyQjtBQUMzQixDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSwrQkFBK0IsRUFBRTtJQUNyRCxDQUFDLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDOUMsQ0FBQyxDQUFDLENBQUM7QUFFSCx1Q0FBdUM7QUFDdkMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsZ0NBQWdDLEVBQUU7SUFDekQsaUNBQWlDO0lBQ2pDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDNUMsdUNBQXVDO0lBQ3ZDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RELG1CQUFtQjtJQUNuQixtQkFBbUIsRUFBRSxDQUFDO0FBQzFCLENBQUMsQ0FBQyxDQUFDO0FBRUgsa0JBQWtCO0FBQ2xCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLDhCQUE4QixFQUFFO0lBQ3JELG9CQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTNCLElBQUksQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO1FBQy9CLFVBQVUsQ0FBQyx1QkFBdUIsRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLFVBQVUsQ0FBQztJQUNqRSxJQUFJLE9BQU8sR0FBSSxDQUFTLENBQUMsT0FBTyxJQUFLLENBQVMsQ0FBQyxLQUFLLENBQUM7SUFDckQsSUFBSSxPQUFPLElBQUksRUFBRSxFQUFFLENBQUM7UUFDaEIsc0JBQXNCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsVUFBVSxDQUFDLHVCQUF1QixFQUFFLDZCQUE2QixDQUFDLENBQUM7SUFDdkUsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsa0NBQWtDO0FBQ2xDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLGdDQUFnQyxFQUFFO0lBQ3ZELElBQUksYUFBYSxHQUFHLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3JELElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTdGLElBQUksYUFBYSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztRQUN6QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDVixRQUFRLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSx1QkFBdUIsQ0FBQyxDQUFDO1FBQzlELENBQUM7SUFDTCxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGZpbGUgQXVkaXRMb2cudHNcclxuICogQGRlc2NyaXB0aW9uIE3Ds2R1bG8gZGUgZ2VzdGnDs24gZGUgcmVnaXN0cm9zIGRlIGF1ZGl0b3LDrWEgSVNPIDI3MDAxLlxyXG4gKiAgICAgICAgICAgICAgU29sbyBwZXJtaXRlIHZpc3VhbGl6YWNpw7NuIGRlIGNhbWJpb3MgZW4gZW50aWRhZGVzIGRlbCBzaXN0ZW1hLlxyXG4gKiBAYXV0aG9yIEVxdWlwbyBkZSBEZXNhcnJvbGxvXHJcbiAqIEBkYXRlIDIwMjVcclxuICogQG1vZHVsZSBBdWRpdG9yaWFcclxuICovXHJcblxyXG4vLyBJbnRlcmZhY2UgcGFyYSBlbCByZWdpc3RybyBkZSBhdWRpdG9yw61hXHJcbmludGVyZmFjZSBJQXVkaXRMb2cge1xyXG4gICAgcmVjSWQ6IG51bWJlcjtcclxuICAgIGRhdGFBcmVhSWQ6IHN0cmluZztcclxuICAgIGNyZWF0ZWRCeTogc3RyaW5nO1xyXG4gICAgY3JlYXRlZE9uOiBzdHJpbmc7XHJcbiAgICBtb2RpZmllZEJ5OiBzdHJpbmc7XHJcbiAgICBtb2RpZmllZE9uOiBzdHJpbmc7XHJcbiAgICBlbnRpdHlOYW1lOiBzdHJpbmc7XHJcbiAgICBmaWVsZE5hbWU6IHN0cmluZztcclxuICAgIG9sZFZhbHVlOiBzdHJpbmc7XHJcbiAgICBuZXdWYWx1ZTogc3RyaW5nO1xyXG4gICAgY2hhbmdlZEJ5OiBzdHJpbmc7XHJcbiAgICBjaGFuZ2VkQXQ6IHN0cmluZztcclxuICAgIGVudGl0eVJlZlJlY0lkOiBudW1iZXI7XHJcbn1cclxuXHJcbi8vIFNlbGVjY2lvbmFyL2Rlc2VsZWNjaW9uYXIgdG9kb3MgbG9zIGNoZWNrYm94ZXNcclxuJChkb2N1bWVudCkub24oJ2NoYW5nZScsICcjc2VsZWN0QWxsQXVkaXRMb2cnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgaXNDaGVja2VkID0gJCh0aGlzKS5pcygnOmNoZWNrZWQnKTtcclxuICAgICQoJy5zZWxlY3RBdWRpdExvZycpLnByb3AoJ2NoZWNrZWQnLCBpc0NoZWNrZWQpO1xyXG59KTtcclxuXHJcbi8vIFZlciBkZXRhbGxlcyBkZWwgcmVnaXN0cm8gc2VsZWNjaW9uYWRvXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuVmlld0F1ZGl0TG9nRGV0YWlscycsIGZ1bmN0aW9uICgpIHtcclxuICAgIHNob3dBdWRpdExvZ0RldGFpbHMoKTtcclxufSk7XHJcblxyXG4vLyBGdW5jacOzbiBwYXJhIG1vc3RyYXIgZGV0YWxsZXMgZGUgYXVkaXRvcsOtYVxyXG5mdW5jdGlvbiBzaG93QXVkaXRMb2dEZXRhaWxzKCkge1xyXG4gICAgdmFyIHJlY0lkOiBudW1iZXIgPSAwO1xyXG4gICAgdmFyIGNvbnRhZG9yID0gMDtcclxuXHJcbiAgICAkKFwiLnNlbGVjdEF1ZGl0TG9nW3R5cGU9Y2hlY2tib3hdXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICgkKHRoaXMpLmlzKFwiOmNoZWNrZWRcIikpIHtcclxuICAgICAgICAgICAgY29udGFkb3IrKztcclxuICAgICAgICAgICAgcmVjSWQgPSBwYXJzZUludCgkKHRoaXMpLmNsb3Nlc3QoJy5yb3ctYXBwJykuYXR0cignZGF0YS1yZWNpZCcpIHx8ICcwJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNvbnRhZG9yID09PSAwKSB7XHJcbiAgICAgICAgd2luZG93c19tZXNzYWdlKFwiRGViZSBzZWxlY2Npb25hciB1biByZWdpc3RybyBwYXJhIHZlciBsb3MgZGV0YWxsZXNcIiwgXCJlcnJvclwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNvbnRhZG9yID4gMSkge1xyXG4gICAgICAgIHdpbmRvd3NfbWVzc2FnZShcIkRlYmUgc2VsZWNjaW9uYXIgc29sbyB1biByZWdpc3Ryb1wiLCBcImluZm9cIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE9idGVuZXIgbG9zIGRhdG9zIGRlbCByZWdpc3Ryb1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IFwiL2F1ZGl0b3JpYS9nZXRieWlkXCIsXHJcbiAgICAgICAgdHlwZTogXCJHRVRcIixcclxuICAgICAgICBkYXRhOiB7IFJlY0lkOiByZWNJZCB9LFxyXG4gICAgICAgIGFzeW5jOiB0cnVlLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhOiBJQXVkaXRMb2cpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVBdWRpdExvZ01vZGFsKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgJCgnLm1vZGFsLUF1ZGl0TG9nRGV0YWlscycpLm1vZGFsKCdzaG93Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3dzX21lc3NhZ2UoXCJFcnJvciBvYnRlbmllbmRvIGRhdG9zIGRlbCByZWdpc3Ryb1wiLCBcImVycm9yXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhocikge1xyXG4gICAgICAgICAgICByZWRpcmVjY2lvbmFyYWxMb2dpbih4aHIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vLyBMbGVuYXIgZWwgbW9kYWwgY29uIGxvcyBkYXRvc1xyXG5mdW5jdGlvbiBwb3B1bGF0ZUF1ZGl0TG9nTW9kYWwoZGF0YTogYW55KSB7XHJcbiAgICAvLyBTb3BvcnRhciB0YW50byBjYW1lbENhc2UgY29tbyBQYXNjYWxDYXNlXHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLXJlY2lkJykudmFsKChkYXRhLnJlY0lkIHx8IGRhdGEuUmVjSWQpPy50b1N0cmluZygpIHx8ICcnKTtcclxuICAgICQoJyNhdWRpdC1kZXRhaWwtZGF0YWFyZWFpZCcpLnZhbChkYXRhLmRhdGFBcmVhSWQgfHwgZGF0YS5EYXRhQXJlYUlkIHx8ICcnKTtcclxuICAgICQoJyNhdWRpdC1kZXRhaWwtZW50aXR5bmFtZScpLnZhbChkYXRhLmVudGl0eU5hbWUgfHwgZGF0YS5FbnRpdHlOYW1lIHx8ICcnKTtcclxuICAgICQoJyNhdWRpdC1kZXRhaWwtZmllbGRuYW1lJykudmFsKGRhdGEuZmllbGROYW1lIHx8IGRhdGEuRmllbGROYW1lIHx8ICcnKTtcclxuICAgICQoJyNhdWRpdC1kZXRhaWwtY2hhbmdlZGJ5JykudmFsKGRhdGEuY2hhbmdlZEJ5IHx8IGRhdGEuQ2hhbmdlZEJ5IHx8ICcnKTtcclxuICAgICQoJyNhdWRpdC1kZXRhaWwtY2hhbmdlZGF0JykudmFsKGZvcm1hdERhdGVUaW1lKGRhdGEuY2hhbmdlZEF0IHx8IGRhdGEuQ2hhbmdlZEF0KSk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLWVudGl0eXJlZnJlY2lkJykudmFsKChkYXRhLmVudGl0eVJlZlJlY0lkIHx8IGRhdGEuRW50aXR5UmVmUmVjSWQpPy50b1N0cmluZygpIHx8ICcnKTtcclxuICAgICQoJyNhdWRpdC1kZXRhaWwtb2xkdmFsdWUnKS52YWwoZGF0YS5vbGRWYWx1ZSB8fCBkYXRhLk9sZFZhbHVlIHx8ICcnKTtcclxuICAgICQoJyNhdWRpdC1kZXRhaWwtbmV3dmFsdWUnKS52YWwoZGF0YS5uZXdWYWx1ZSB8fCBkYXRhLk5ld1ZhbHVlIHx8ICcnKTtcclxufVxyXG5cclxuLy8gRm9ybWF0ZWFyIGZlY2hhIHkgaG9yYVxyXG5mdW5jdGlvbiBmb3JtYXREYXRlVGltZShkYXRlU3RyaW5nOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCFkYXRlU3RyaW5nKSByZXR1cm4gJyc7XHJcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGRhdGVTdHJpbmcpO1xyXG4gICAgdmFyIGRheSA9IGRhdGUuZ2V0RGF0ZSgpIDwgMTAgPyAnMCcgKyBkYXRlLmdldERhdGUoKSA6IFN0cmluZyhkYXRlLmdldERhdGUoKSk7XHJcbiAgICB2YXIgbW9udGggPSAoZGF0ZS5nZXRNb250aCgpICsgMSkgPCAxMCA/ICcwJyArIChkYXRlLmdldE1vbnRoKCkgKyAxKSA6IFN0cmluZyhkYXRlLmdldE1vbnRoKCkgKyAxKTtcclxuICAgIHZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xyXG4gICAgdmFyIGhvdXJzID0gZGF0ZS5nZXRIb3VycygpIDwgMTAgPyAnMCcgKyBkYXRlLmdldEhvdXJzKCkgOiBTdHJpbmcoZGF0ZS5nZXRIb3VycygpKTtcclxuICAgIHZhciBtaW51dGVzID0gZGF0ZS5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyArIGRhdGUuZ2V0TWludXRlcygpIDogU3RyaW5nKGRhdGUuZ2V0TWludXRlcygpKTtcclxuICAgIHZhciBzZWNvbmRzID0gZGF0ZS5nZXRTZWNvbmRzKCkgPCAxMCA/ICcwJyArIGRhdGUuZ2V0U2Vjb25kcygpIDogU3RyaW5nKGRhdGUuZ2V0U2Vjb25kcygpKTtcclxuICAgIHJldHVybiBgJHtkYXl9LyR7bW9udGh9LyR7eWVhcn0gJHtob3Vyc306JHttaW51dGVzfToke3NlY29uZHN9YDtcclxufVxyXG5cclxuLy8gQ2VycmFyIG1vZGFsIGRlIGRldGFsbGVzXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY2xvc2UtbW9kYWwtYXVkaXRsb2ctZGV0YWlscycsIGZ1bmN0aW9uICgpIHtcclxuICAgICQoJy5tb2RhbC1BdWRpdExvZ0RldGFpbHMnKS5tb2RhbCgnaGlkZScpO1xyXG59KTtcclxuXHJcbi8vIERvYmxlIGNsaWMgZW4gZmlsYSBwYXJhIHZlciBkZXRhbGxlc1xyXG4kKGRvY3VtZW50KS5vbignZGJsY2xpY2snLCAnLnRib2R5LVRhYmxlLUF1ZGl0TG9nIC5yb3ctYXBwJywgZnVuY3Rpb24gKCkge1xyXG4gICAgLy8gRGVzbWFyY2FyIHRvZG9zIGxvcyBjaGVja2JveGVzXHJcbiAgICAkKCcuc2VsZWN0QXVkaXRMb2cnKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xyXG4gICAgLy8gTWFyY2FyIGVsIGNoZWNrYm94IGRlIGxhIGZpbGEgYWN0dWFsXHJcbiAgICAkKHRoaXMpLmZpbmQoJy5zZWxlY3RBdWRpdExvZycpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKTtcclxuICAgIC8vIE1vc3RyYXIgZGV0YWxsZXNcclxuICAgIHNob3dBdWRpdExvZ0RldGFpbHMoKTtcclxufSk7XHJcblxyXG4vLyBGaWx0cm8gZGUgZGF0b3NcclxuJChkb2N1bWVudCkub24oJ2NoYW5nZScsICcjYXVkaXRsb2ctcGFnZSAub3B0aW9uRmlsdGVyJywgZnVuY3Rpb24gKCkge1xyXG4gICAgb3B0aW9uRmlsdGVyRnVuY3Rpb24odGhpcyk7XHJcblxyXG4gICAgaWYgKCQoJy50ZXh0RmlsdGVyJykudmFsKCkgIT0gXCJcIikge1xyXG4gICAgICAgIERhdGFmaWx0ZXIoXCIudGJvZHktVGFibGUtQXVkaXRMb2dcIiwgXCIvYXVkaXRvcmlhL0ZpbHRlck9yTW9yZURhdGFcIik7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2tleXVwJywgJyNhdWRpdGxvZy1wYWdlIC50ZXh0RmlsdGVyTWFzaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICB2YXIga2V5Y29kZSA9IChlIGFzIGFueSkua2V5Q29kZSB8fCAoZSBhcyBhbnkpLndoaWNoO1xyXG4gICAgaWYgKGtleWNvZGUgPT0gMTMpIHtcclxuICAgICAgICB0ZXh0RmlsdGVyTWFza0Z1bmN0aW9uKHRoaXMpO1xyXG4gICAgICAgIERhdGFmaWx0ZXIoXCIudGJvZHktVGFibGUtQXVkaXRMb2dcIiwgXCIvYXVkaXRvcmlhL0ZpbHRlck9yTW9yZURhdGFcIik7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLy8gU2Nyb2xsIGluZmluaXRvIHBhcmEgcGFnaW5hY2nDs25cclxuJChkb2N1bWVudCkub24oJ3Njcm9sbCcsICcjYXVkaXRsb2ctcGFnZSAjY29udGVudC1zY3JvbGwnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgY3VycmVudHNjcm9sbCA9ICQoXCIjY29udGVudC1zY3JvbGxcIikuc2Nyb2xsVG9wKCk7XHJcbiAgICBsZXQgbWF4c2Nyb2xsID0gJChcIi50YmxBdWRpdExvZ1wiKS5vdXRlckhlaWdodCh0cnVlKSAtICQoXCIjY29udGVudC1zY3JvbGxcIikub3V0ZXJIZWlnaHQodHJ1ZSk7XHJcblxyXG4gICAgaWYgKGN1cnJlbnRzY3JvbGwgPT0gTWF0aC5yb3VuZChtYXhzY3JvbGwpKSB7XHJcbiAgICAgICAgaWYgKCFpc0J1c3kpIHtcclxuICAgICAgICAgICAgbW9yZWRhdGEobWF4c2Nyb2xsLCBcImF1ZGl0b3JpYVwiLCBcIi50Ym9keS1UYWJsZS1BdWRpdExvZ1wiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=