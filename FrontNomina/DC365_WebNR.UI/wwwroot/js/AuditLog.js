/**
 * @file AuditLog.ts
 * @description Módulo de gestión de registros de auditoría ISO 27001.
 *              Solo permite visualización de cambios en entidades del sistema.
 * @author Equipo de Desarrollo
 * @date 2025
 * @module Auditoria
 */
// Seleccionar/deseleccionar todos los checkboxes
$(document).on('change', '#selectAllAuditLog', function () {
    var isChecked = $(this).is(':checked');
    $('.selectAuditLog').prop('checked', isChecked);
});
// Ver detalles del registro seleccionado
$(document).on('click', '.ViewAuditLogDetails', function () {
    showAuditLogDetails();
});
// Función para mostrar detalles de auditoría
function showAuditLogDetails() {
    var recId = 0;
    var contador = 0;
    $(".selectAuditLog[type=checkbox]").each(function () {
        if ($(this).is(":checked")) {
            contador++;
            recId = parseInt($(this).closest('.row-app').attr('data-recid') || '0');
        }
    });
    if (contador === 0) {
        windows_message("Debe seleccionar un registro para ver los detalles", "error");
        return;
    }
    if (contador > 1) {
        windows_message("Debe seleccionar solo un registro", "info");
        return;
    }
    // Obtener los datos del registro
    $.ajax({
        url: "/auditoria/getbyid",
        type: "GET",
        data: { RecId: recId },
        async: true,
        success: function (data) {
            if (data != null) {
                populateAuditLogModal(data);
                $('.modal-AuditLogDetails').modal('show');
            }
            else {
                windows_message("Error obteniendo datos del registro", "error");
            }
        },
        error: function (xhr) {
            redireccionaralLogin(xhr);
        }
    });
}
// Llenar el modal con los datos
function populateAuditLogModal(data) {
    var _a, _b;
    // Soportar tanto camelCase como PascalCase
    $('#audit-detail-recid').val(((_a = (data.recId || data.RecId)) === null || _a === void 0 ? void 0 : _a.toString()) || '');
    $('#audit-detail-dataareaid').val(data.dataAreaId || data.DataAreaId || '');
    $('#audit-detail-entityname').val(data.entityName || data.EntityName || '');
    $('#audit-detail-fieldname').val(data.fieldName || data.FieldName || '');
    $('#audit-detail-changedby').val(data.changedBy || data.ChangedBy || '');
    $('#audit-detail-changedat').val(formatDateTime(data.changedAt || data.ChangedAt));
    $('#audit-detail-entityrefrecid').val(((_b = (data.entityRefRecId || data.EntityRefRecId)) === null || _b === void 0 ? void 0 : _b.toString()) || '');
    $('#audit-detail-oldvalue').val(data.oldValue || data.OldValue || '');
    $('#audit-detail-newvalue').val(data.newValue || data.NewValue || '');
}
// Formatear fecha y hora
function formatDateTime(dateString) {
    if (!dateString)
        return '';
    var date = new Date(dateString);
    var day = date.getDate() < 10 ? '0' + date.getDate() : String(date.getDate());
    var month = (date.getMonth() + 1) < 10 ? '0' + (date.getMonth() + 1) : String(date.getMonth() + 1);
    var year = date.getFullYear();
    var hours = date.getHours() < 10 ? '0' + date.getHours() : String(date.getHours());
    var minutes = date.getMinutes() < 10 ? '0' + date.getMinutes() : String(date.getMinutes());
    var seconds = date.getSeconds() < 10 ? '0' + date.getSeconds() : String(date.getSeconds());
    return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
}
// Cerrar modal de detalles
$(document).on('click', '.close-modal-auditlog-details', function () {
    $('.modal-AuditLogDetails').modal('hide');
});
// Doble clic en fila para ver detalles
$(document).on('dblclick', '.tbody-Table-AuditLog .row-app', function () {
    // Desmarcar todos los checkboxes
    $('.selectAuditLog').prop('checked', false);
    // Marcar el checkbox de la fila actual
    $(this).find('.selectAuditLog').prop('checked', true);
    // Mostrar detalles
    showAuditLogDetails();
});
// Filtro de datos
$(document).on('change', '#auditlog-page .optionFilter', function () {
    optionFilterFunction(this);
    if ($('.textFilter').val() != "") {
        Datafilter(".tbody-Table-AuditLog", "/auditoria/FilterOrMoreData");
    }
});
$(document).on('keyup', '#auditlog-page .textFilterMask', function (e) {
    var keycode = e.keyCode || e.which;
    if (keycode == 13) {
        textFilterMaskFunction(this);
        Datafilter(".tbody-Table-AuditLog", "/auditoria/FilterOrMoreData");
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXVkaXRMb2cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9UeXBlU2NyaXB0RmlsZS9BdWRpdExvZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztHQU9HO0FBbUJILGlEQUFpRDtBQUNqRCxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRSxvQkFBb0IsRUFBRTtJQUMzQyxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDLENBQUM7QUFFSCx5Q0FBeUM7QUFDekMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUU7SUFDNUMsbUJBQW1CLEVBQUUsQ0FBQztBQUMxQixDQUFDLENBQUMsQ0FBQztBQUVILDZDQUE2QztBQUM3QyxTQUFTLG1CQUFtQjtJQUN4QixJQUFJLEtBQUssR0FBVyxDQUFDLENBQUM7SUFDdEIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBRWpCLENBQUMsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNyQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUN6QixRQUFRLEVBQUUsQ0FBQztZQUNYLEtBQUssR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDNUUsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxRQUFRLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDakIs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RyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUM5RSxJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNuRyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDOUIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQ25GLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztJQUMzRixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7SUFDM0YsT0FBTyxHQUFHLEdBQUcsSUFBSSxLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssSUFBSSxPQUFPLElBQUksT0FBTyxFQUFFLENBQUM7QUFDcEUsQ0FBQztBQUVELDJCQUEyQjtBQUMzQixDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSwrQkFBK0IsRUFBRTtJQUNyRCxDQUFDLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDOUMsQ0FBQyxDQUFDLENBQUM7QUFFSCx1Q0FBdUM7QUFDdkMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsZ0NBQWdDLEVBQUU7SUFDekQsaUNBQWlDO0lBQ2pDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDNUMsdUNBQXVDO0lBQ3ZDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RELG1CQUFtQjtJQUNuQixtQkFBbUIsRUFBRSxDQUFDO0FBQzFCLENBQUMsQ0FBQyxDQUFDO0FBRUgsa0JBQWtCO0FBQ2xCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLDhCQUE4QixFQUFFO0lBQ3JELG9CQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTNCLElBQUksQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO1FBQy9CLFVBQVUsQ0FBQyx1QkFBdUIsRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLFVBQVUsQ0FBQztJQUNqRSxJQUFJLE9BQU8sR0FBSSxDQUFTLENBQUMsT0FBTyxJQUFLLENBQVMsQ0FBQyxLQUFLLENBQUM7SUFDckQsSUFBSSxPQUFPLElBQUksRUFBRSxFQUFFLENBQUM7UUFDaEIsc0JBQXNCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsVUFBVSxDQUFDLHVCQUF1QixFQUFFLDZCQUE2QixDQUFDLENBQUM7SUFDdkUsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBmaWxlIEF1ZGl0TG9nLnRzXHJcbiAqIEBkZXNjcmlwdGlvbiBNw7NkdWxvIGRlIGdlc3Rpw7NuIGRlIHJlZ2lzdHJvcyBkZSBhdWRpdG9yw61hIElTTyAyNzAwMS5cclxuICogICAgICAgICAgICAgIFNvbG8gcGVybWl0ZSB2aXN1YWxpemFjacOzbiBkZSBjYW1iaW9zIGVuIGVudGlkYWRlcyBkZWwgc2lzdGVtYS5cclxuICogQGF1dGhvciBFcXVpcG8gZGUgRGVzYXJyb2xsb1xyXG4gKiBAZGF0ZSAyMDI1XHJcbiAqIEBtb2R1bGUgQXVkaXRvcmlhXHJcbiAqL1xyXG5cclxuLy8gSW50ZXJmYWNlIHBhcmEgZWwgcmVnaXN0cm8gZGUgYXVkaXRvcsOtYVxyXG5pbnRlcmZhY2UgSUF1ZGl0TG9nIHtcclxuICAgIHJlY0lkOiBudW1iZXI7XHJcbiAgICBkYXRhQXJlYUlkOiBzdHJpbmc7XHJcbiAgICBjcmVhdGVkQnk6IHN0cmluZztcclxuICAgIGNyZWF0ZWRPbjogc3RyaW5nO1xyXG4gICAgbW9kaWZpZWRCeTogc3RyaW5nO1xyXG4gICAgbW9kaWZpZWRPbjogc3RyaW5nO1xyXG4gICAgZW50aXR5TmFtZTogc3RyaW5nO1xyXG4gICAgZmllbGROYW1lOiBzdHJpbmc7XHJcbiAgICBvbGRWYWx1ZTogc3RyaW5nO1xyXG4gICAgbmV3VmFsdWU6IHN0cmluZztcclxuICAgIGNoYW5nZWRCeTogc3RyaW5nO1xyXG4gICAgY2hhbmdlZEF0OiBzdHJpbmc7XHJcbiAgICBlbnRpdHlSZWZSZWNJZDogbnVtYmVyO1xyXG59XHJcblxyXG4vLyBTZWxlY2Npb25hci9kZXNlbGVjY2lvbmFyIHRvZG9zIGxvcyBjaGVja2JveGVzXHJcbiQoZG9jdW1lbnQpLm9uKCdjaGFuZ2UnLCAnI3NlbGVjdEFsbEF1ZGl0TG9nJywgZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGlzQ2hlY2tlZCA9ICQodGhpcykuaXMoJzpjaGVja2VkJyk7XHJcbiAgICAkKCcuc2VsZWN0QXVkaXRMb2cnKS5wcm9wKCdjaGVja2VkJywgaXNDaGVja2VkKTtcclxufSk7XHJcblxyXG4vLyBWZXIgZGV0YWxsZXMgZGVsIHJlZ2lzdHJvIHNlbGVjY2lvbmFkb1xyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLlZpZXdBdWRpdExvZ0RldGFpbHMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBzaG93QXVkaXRMb2dEZXRhaWxzKCk7XHJcbn0pO1xyXG5cclxuLy8gRnVuY2nDs24gcGFyYSBtb3N0cmFyIGRldGFsbGVzIGRlIGF1ZGl0b3LDrWFcclxuZnVuY3Rpb24gc2hvd0F1ZGl0TG9nRGV0YWlscygpIHtcclxuICAgIHZhciByZWNJZDogbnVtYmVyID0gMDtcclxuICAgIHZhciBjb250YWRvciA9IDA7XHJcblxyXG4gICAgJChcIi5zZWxlY3RBdWRpdExvZ1t0eXBlPWNoZWNrYm94XVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoJCh0aGlzKS5pcyhcIjpjaGVja2VkXCIpKSB7XHJcbiAgICAgICAgICAgIGNvbnRhZG9yKys7XHJcbiAgICAgICAgICAgIHJlY0lkID0gcGFyc2VJbnQoJCh0aGlzKS5jbG9zZXN0KCcucm93LWFwcCcpLmF0dHIoJ2RhdGEtcmVjaWQnKSB8fCAnMCcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb250YWRvciA9PT0gMCkge1xyXG4gICAgICAgIHdpbmRvd3NfbWVzc2FnZShcIkRlYmUgc2VsZWNjaW9uYXIgdW4gcmVnaXN0cm8gcGFyYSB2ZXIgbG9zIGRldGFsbGVzXCIsIFwiZXJyb3JcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChjb250YWRvciA+IDEpIHtcclxuICAgICAgICB3aW5kb3dzX21lc3NhZ2UoXCJEZWJlIHNlbGVjY2lvbmFyIHNvbG8gdW4gcmVnaXN0cm9cIiwgXCJpbmZvXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPYnRlbmVyIGxvcyBkYXRvcyBkZWwgcmVnaXN0cm9cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdXJsOiBcIi9hdWRpdG9yaWEvZ2V0YnlpZFwiLFxyXG4gICAgICAgIHR5cGU6IFwiR0VUXCIsXHJcbiAgICAgICAgZGF0YTogeyBSZWNJZDogcmVjSWQgfSxcclxuICAgICAgICBhc3luYzogdHJ1ZSxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YTogSUF1ZGl0TG9nKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHBvcHVsYXRlQXVkaXRMb2dNb2RhbChkYXRhKTtcclxuICAgICAgICAgICAgICAgICQoJy5tb2RhbC1BdWRpdExvZ0RldGFpbHMnKS5tb2RhbCgnc2hvdycpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgd2luZG93c19tZXNzYWdlKFwiRXJyb3Igb2J0ZW5pZW5kbyBkYXRvcyBkZWwgcmVnaXN0cm9cIiwgXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIpIHtcclxuICAgICAgICAgICAgcmVkaXJlY2Npb25hcmFsTG9naW4oeGhyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gTGxlbmFyIGVsIG1vZGFsIGNvbiBsb3MgZGF0b3NcclxuZnVuY3Rpb24gcG9wdWxhdGVBdWRpdExvZ01vZGFsKGRhdGE6IGFueSkge1xyXG4gICAgLy8gU29wb3J0YXIgdGFudG8gY2FtZWxDYXNlIGNvbW8gUGFzY2FsQ2FzZVxyXG4gICAgJCgnI2F1ZGl0LWRldGFpbC1yZWNpZCcpLnZhbCgoZGF0YS5yZWNJZCB8fCBkYXRhLlJlY0lkKT8udG9TdHJpbmcoKSB8fCAnJyk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLWRhdGFhcmVhaWQnKS52YWwoZGF0YS5kYXRhQXJlYUlkIHx8IGRhdGEuRGF0YUFyZWFJZCB8fCAnJyk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLWVudGl0eW5hbWUnKS52YWwoZGF0YS5lbnRpdHlOYW1lIHx8IGRhdGEuRW50aXR5TmFtZSB8fCAnJyk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLWZpZWxkbmFtZScpLnZhbChkYXRhLmZpZWxkTmFtZSB8fCBkYXRhLkZpZWxkTmFtZSB8fCAnJyk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLWNoYW5nZWRieScpLnZhbChkYXRhLmNoYW5nZWRCeSB8fCBkYXRhLkNoYW5nZWRCeSB8fCAnJyk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLWNoYW5nZWRhdCcpLnZhbChmb3JtYXREYXRlVGltZShkYXRhLmNoYW5nZWRBdCB8fCBkYXRhLkNoYW5nZWRBdCkpO1xyXG4gICAgJCgnI2F1ZGl0LWRldGFpbC1lbnRpdHlyZWZyZWNpZCcpLnZhbCgoZGF0YS5lbnRpdHlSZWZSZWNJZCB8fCBkYXRhLkVudGl0eVJlZlJlY0lkKT8udG9TdHJpbmcoKSB8fCAnJyk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLW9sZHZhbHVlJykudmFsKGRhdGEub2xkVmFsdWUgfHwgZGF0YS5PbGRWYWx1ZSB8fCAnJyk7XHJcbiAgICAkKCcjYXVkaXQtZGV0YWlsLW5ld3ZhbHVlJykudmFsKGRhdGEubmV3VmFsdWUgfHwgZGF0YS5OZXdWYWx1ZSB8fCAnJyk7XHJcbn1cclxuXHJcbi8vIEZvcm1hdGVhciBmZWNoYSB5IGhvcmFcclxuZnVuY3Rpb24gZm9ybWF0RGF0ZVRpbWUoZGF0ZVN0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGlmICghZGF0ZVN0cmluZykgcmV0dXJuICcnO1xyXG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyaW5nKTtcclxuICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKSA8IDEwID8gJzAnICsgZGF0ZS5nZXREYXRlKCkgOiBTdHJpbmcoZGF0ZS5nZXREYXRlKCkpO1xyXG4gICAgdmFyIG1vbnRoID0gKGRhdGUuZ2V0TW9udGgoKSArIDEpIDwgMTAgPyAnMCcgKyAoZGF0ZS5nZXRNb250aCgpICsgMSkgOiBTdHJpbmcoZGF0ZS5nZXRNb250aCgpICsgMSk7XHJcbiAgICB2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgIHZhciBob3VycyA9IGRhdGUuZ2V0SG91cnMoKSA8IDEwID8gJzAnICsgZGF0ZS5nZXRIb3VycygpIDogU3RyaW5nKGRhdGUuZ2V0SG91cnMoKSk7XHJcbiAgICB2YXIgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgKyBkYXRlLmdldE1pbnV0ZXMoKSA6IFN0cmluZyhkYXRlLmdldE1pbnV0ZXMoKSk7XHJcbiAgICB2YXIgc2Vjb25kcyA9IGRhdGUuZ2V0U2Vjb25kcygpIDwgMTAgPyAnMCcgKyBkYXRlLmdldFNlY29uZHMoKSA6IFN0cmluZyhkYXRlLmdldFNlY29uZHMoKSk7XHJcbiAgICByZXR1cm4gYCR7ZGF5fS8ke21vbnRofS8ke3llYXJ9ICR7aG91cnN9OiR7bWludXRlc306JHtzZWNvbmRzfWA7XHJcbn1cclxuXHJcbi8vIENlcnJhciBtb2RhbCBkZSBkZXRhbGxlc1xyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNsb3NlLW1vZGFsLWF1ZGl0bG9nLWRldGFpbHMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAkKCcubW9kYWwtQXVkaXRMb2dEZXRhaWxzJykubW9kYWwoJ2hpZGUnKTtcclxufSk7XHJcblxyXG4vLyBEb2JsZSBjbGljIGVuIGZpbGEgcGFyYSB2ZXIgZGV0YWxsZXNcclxuJChkb2N1bWVudCkub24oJ2RibGNsaWNrJywgJy50Ym9keS1UYWJsZS1BdWRpdExvZyAucm93LWFwcCcsIGZ1bmN0aW9uICgpIHtcclxuICAgIC8vIERlc21hcmNhciB0b2RvcyBsb3MgY2hlY2tib3hlc1xyXG4gICAgJCgnLnNlbGVjdEF1ZGl0TG9nJykucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTtcclxuICAgIC8vIE1hcmNhciBlbCBjaGVja2JveCBkZSBsYSBmaWxhIGFjdHVhbFxyXG4gICAgJCh0aGlzKS5maW5kKCcuc2VsZWN0QXVkaXRMb2cnKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7XHJcbiAgICAvLyBNb3N0cmFyIGRldGFsbGVzXHJcbiAgICBzaG93QXVkaXRMb2dEZXRhaWxzKCk7XHJcbn0pO1xyXG5cclxuLy8gRmlsdHJvIGRlIGRhdG9zXHJcbiQoZG9jdW1lbnQpLm9uKCdjaGFuZ2UnLCAnI2F1ZGl0bG9nLXBhZ2UgLm9wdGlvbkZpbHRlcicsIGZ1bmN0aW9uICgpIHtcclxuICAgIG9wdGlvbkZpbHRlckZ1bmN0aW9uKHRoaXMpO1xyXG5cclxuICAgIGlmICgkKCcudGV4dEZpbHRlcicpLnZhbCgpICE9IFwiXCIpIHtcclxuICAgICAgICBEYXRhZmlsdGVyKFwiLnRib2R5LVRhYmxlLUF1ZGl0TG9nXCIsIFwiL2F1ZGl0b3JpYS9GaWx0ZXJPck1vcmVEYXRhXCIpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbiQoZG9jdW1lbnQpLm9uKCdrZXl1cCcsICcjYXVkaXRsb2ctcGFnZSAudGV4dEZpbHRlck1hc2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgdmFyIGtleWNvZGUgPSAoZSBhcyBhbnkpLmtleUNvZGUgfHwgKGUgYXMgYW55KS53aGljaDtcclxuICAgIGlmIChrZXljb2RlID09IDEzKSB7XHJcbiAgICAgICAgdGV4dEZpbHRlck1hc2tGdW5jdGlvbih0aGlzKTtcclxuICAgICAgICBEYXRhZmlsdGVyKFwiLnRib2R5LVRhYmxlLUF1ZGl0TG9nXCIsIFwiL2F1ZGl0b3JpYS9GaWx0ZXJPck1vcmVEYXRhXCIpO1xyXG4gICAgfVxyXG59KTtcclxuIl19